import de.undercouch.gradle.tasks.download.Download

import java.nio.file.Path
import java.nio.file.Paths

project.plugins.apply "docker-common"

tasks.register("checkForLiferayLicense") {
	onlyIf("using the Liferay service") { config.useLiferay }
	onlyIf("running Liferay DXP") { config.dockerImageLiferayDXP }

	doFirst {
		FileCollection licenseXmlFileCollection = project.fileTree("configs") {
			include "**/osgi/modules/*.xml"
		}.filter {
			it.text.contains("<license>")
		}

		if (licenseXmlFileCollection.isEmpty()) {
			throw new GradleException("Please add a license to configs/common/osgi/modules/")
		}
	}
}

tasks.register("prepareHotfixes", Download) {
	dest project.layout.dir(project.provider {project.file("configs/common/patching")})

	onlyIf {
		!config.hotfixURLs.isEmpty()
	}

	src config.hotfixURLs
}